<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROMINT Finance</title>
    
    <!-- PWA & Mobile Optimization -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/lucide-react/lucide/main/icons/wallet.png">
    
    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use standard Lucide core for stability -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase Compat SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <!-- Theme Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        violet: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        }
                    },
                    borderRadius: {
                        '3xl': '1.5rem',
                        '4xl': '2rem',
                        '5xl': '3rem',
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; transition: background-color 0.5s ease; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.1); border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.3); }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.5); }
        .dark input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        
        @keyframes scaleIn {
            from { transform: scale(0.98); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-scale-in { animation: scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .premium-shadow { box-shadow: 0 10px 40px -10px rgba(0,0,0,0.06); }
        .dark .premium-shadow { box-shadow: none; border: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAQo8hMmZ6hgqhga6-oSFw_tG8NEfg8jv0",
            authDomain: "promint-99f8e.firebaseapp.com",
            projectId: "promint-99f8e",
            storageBucket: "promint-99f8e.firebasestorage.app",
            messagingSenderId: "263707102690",
            appId: "1:263707102690:web:2c7116155bbe8acb743dbb",
            measurementId: "G-8KNZ8B883B"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'promint-finance';

        try {
            db.enablePersistence().catch(() => {});
        } catch (e) {}

        const PROMINT_LOGO_SVG = `<svg width="512" height="512" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="premiumGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" /><stop offset="100%" style="stop-color:#D946EF;stop-opacity:1" /></linearGradient><filter id="logoShadow" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur in="SourceAlpha" stdDeviation="12" /><feOffset dx="0" dy="8" result="offsetblur" /><feComponentTransfer><feFuncA type="linear" slope="0.4" /></feComponentTransfer><feMerge><feMergeNode /><feMergeNode in="SourceGraphic" /></feMerge></filter></defs><rect width="512" height="512" rx="140" fill="url(#premiumGrad)"/><g filter="url(#logoShadow)" transform="translate(-71.5, 0)"><path d="M140 380V132H250C315 132 340 170 340 215C340 260 315 298 250 298H195V380H140ZM195 245H245C275 245 285 235 285 215C285 195 275 185 245 185H195V245Z" fill="white"/><path d="M340 380V132H400L450 240L500 132H560V380H505V210L450 320L395 210V380H340Z" fill="white" transform="translate(-45, 0)"/> <rect x="290" y="245" width="55" height="135" fill="white" opacity="1"/></g></svg>`;
        const LOGO_DATA_URL = `data:image/svg+xml;base64,${btoa(PROMINT_LOGO_SVG)}`;

        const CURRENCY_OPTIONS = [
            { code: 'LKR', label: 'LKR (Rs.)', symbol: 'Rs.' },
            { code: 'USD', label: 'USD ($)', symbol: '$' },
            { code: 'EUR', label: 'EUR (€)', symbol: '€' },
            { code: 'GBP', label: 'GBP (£)', symbol: '£' },
        ];

        const PRESET_COLORS = ['#8B5CF6', '#7C3AED', '#D946EF', '#6366F1', '#EC4899', '#FF7043', '#66BB6A', '#42A5F5', '#FFCA28', '#26A69A'];

        /**
         * Manual Icon Component for React 18 / Lucide UMD
         * Resolves Error 130 and lucide.createSvg missing error.
         */
        const Icon = ({ name, size = 20, strokeWidth = 2.5, className = "" }) => {
            const iconData = lucide.icons[name] || lucide.icons['HelpCircle'];
            if (!iconData) return null;

            return (
                <svg
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth={strokeWidth}
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={`lucide lucide-${name.toLowerCase()} ${className}`}
                >
                    {iconData.map(([tag, attrs], i) => React.createElement(tag, { ...attrs, key: i }))}
                </svg>
            );
        };

        function App() {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [transactions, setTransactions] = useState([]);
            const [categories, setCategories] = useState([]);
            const [budgets, setBudgets] = useState([]);
            const [savingsGoals, setSavingsGoals] = useState([]);
            const [profile, setProfile] = useState({ name: 'User', email: '', currency: 'LKR' });
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [syncing, setSyncing] = useState(false);

            // Modals
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isCategoryModalOpen, setIsCategoryModalOpen] = useState(false);
            const [isBudgetModalOpen, setIsBudgetModalOpen] = useState(false);
            const [isGoalModalOpen, setIsGoalModalOpen] = useState(false);
            const [isGeneralSavingModalOpen, setIsGeneralSavingModalOpen] = useState(false);
            const [editingGoal, setEditingGoal] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');

            const currentMonthKey = new Date().toISOString().slice(0, 7);
            const todayDate = new Date().toISOString().split('T')[0];
            const firstOfMonthDate = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
            const [reportRange, setReportRange] = useState({ start: firstOfMonthDate, end: todayDate });

            useEffect(() => {
                const initAuth = async () => { try { await auth.signInAnonymously(); } catch (e) {} };
                initAuth();
                const unsubAuth = auth.onAuthStateChanged(setUser);
                window.addEventListener('online', () => setIsOnline(true));
                window.addEventListener('offline', () => setIsOnline(false));
                return () => unsubAuth();
            }, []);

            useEffect(() => {
                if (!user) return;
                setSyncing(true);
                const uid = user.uid;

                const unsubTx = db.collection('artifacts').doc(appId).collection('users').doc(uid).collection('transactions')
                    .onSnapshot((s) => {
                        setTransactions(s.docs.map(d => ({ id: d.id, ...d.data() })).sort((a, b) => b.date.localeCompare(a.date)));
                        setSyncing(false);
                    }, () => setSyncing(false));

                const unsubCat = db.collection('artifacts').doc(appId).collection('users').doc(uid).collection('categories')
                    .onSnapshot((s) => {
                        const data = s.docs.map(d => ({ id: d.id, ...d.data() }));
                        setCategories(data.length > 0 ? data : [
                            { id: '1', name: 'Food', color: '#FF7043', type: 'Expense' },
                            { id: '2', name: 'Rent', color: '#7E57C2', type: 'Expense' },
                            { id: '3', name: 'Savings', color: '#8B5CF6', type: 'Expense' }
                        ]);
                    });

                const unsubBud = db.collection('artifacts').doc(appId).collection('users').doc(uid).collection('budgets')
                    .onSnapshot((s) => setBudgets(s.docs.map(d => ({ id: d.id, ...d.data() }))));

                const unsubSav = db.collection('artifacts').doc(appId).collection('users').doc(uid).collection('savingsGoals')
                    .onSnapshot((s) => setSavingsGoals(s.docs.map(d => ({ id: d.id, ...d.data() }))));

                const unsubPro = db.collection('artifacts').doc(appId).collection('users').doc(uid).collection('settings').doc('profile')
                    .onSnapshot((d) => { if (d.exists) setProfile(d.data()); });

                return () => { unsubTx(); unsubCat(); unsubBud(); unsubSav(); unsubPro(); };
            }, [user]);

            // Derived States
            const stats = useMemo(() => {
                const inc = transactions.filter(t => t.type === 'Income').reduce((a, c) => a + Number(c.amount || 0), 0);
                const exp = transactions.filter(t => t.type === 'Expense').reduce((a, c) => a + Number(c.amount || 0), 0);
                return { income: inc, expenses: exp, net: inc + exp };
            }, [transactions]);

            const budgetPerformance = useMemo(() => {
                return budgets.map(b => {
                    const actual = transactions.filter(t => t.category.toLowerCase() === b.category.toLowerCase() && t.date.startsWith(b.month)).reduce((a, c) => a + Math.abs(Number(c.amount || 0)), 0);
                    return { ...b, actual, remaining: b.amount - actual, percent: b.amount > 0 ? Math.min((actual / b.amount) * 100, 100) : 0, isOver: actual > b.amount };
                });
            }, [budgets, transactions]);

            const totalBudgetStats = useMemo(() => {
                const activeBudgets = budgets.filter(b => b.month === currentMonthKey);
                const totalAlloc = activeBudgets.reduce((a, c) => a + Number(c.amount || 0), 0);
                const totalSpent = activeBudgets.reduce((acc, b) => {
                    const actual = transactions.filter(t => t.category.toLowerCase() === b.category.toLowerCase() && t.date.startsWith(currentMonthKey)).reduce((a, c) => a + Math.abs(Number(c.amount || 0)), 0);
                    return acc + actual;
                }, 0);
                return { totalAllocated: totalAlloc, totalSpent, isOver: totalSpent > totalAlloc, remaining: totalAlloc - totalSpent, percent: totalAlloc > 0 ? (totalSpent / totalAlloc) * 100 : 0 };
            }, [budgets, transactions, currentMonthKey]);

            const savingsStats = useMemo(() => {
                const saved = transactions.filter(t => t.category.toLowerCase() === 'savings').reduce((a, c) => a + Math.abs(Number(c.amount || 0)), 0);
                const alloc = savingsGoals.reduce((a, c) => a + Number(c.saved || 0), 0);
                return { total: Math.max(0, saved), allocated: alloc, remaining: Math.max(0, saved - alloc) };
            }, [transactions, savingsGoals]);

            // Unified Report List Name to resolve ReferenceError
            const reportTransactionsList = useMemo(() => {
                return transactions.filter(t => t.date >= reportRange.start && t.date <= reportRange.end);
            }, [transactions, reportRange]);

            const reportSummaryData = useMemo(() => {
                const inc = reportTransactionsList.filter(t => t.type === 'Income').reduce((a, c) => a + Number(c.amount || 0), 0);
                const exp = reportTransactionsList.filter(t => t.type === 'Expense').reduce((a, c) => a + Number(c.amount || 0), 0);
                return { income: inc, expense: exp, net: inc + exp };
            }, [reportTransactionsList]);

            // Handlers
            const saveToCloud = async (col, id, data) => { 
                if (user) await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection(col).doc(id).set(data, { merge: true }); 
            };
            const removeFromCloud = async (col, id) => { 
                if (user) await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection(col).doc(id).delete(); 
            };

            const addTransaction = (newTx) => { const id = Date.now().toString(); saveToCloud('transactions', id, newTx); setIsModalOpen(false); };
            const addCategory = (newCat) => { const id = Date.now().toString(); saveToCloud('categories', id, newCat); setIsCategoryModalOpen(false); };
            const addBudget = (newBudget) => { const id = Date.now().toString(); saveToCloud('budgets', id, newBudget); setIsBudgetModalOpen(false); };
            
            const deleteTransaction = (id) => removeFromCloud('transactions', id);
            const deleteCategory = (id) => removeFromCloud('categories', id);
            const deleteBudget = (id) => removeFromCloud('budgets', id);
            const deleteSavingsGoal = (id) => removeFromCloud('savingsGoals', id);

            const updateProfile = (data) => { if (user) db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('settings').doc('profile').set(data); };
            const formatCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: profile.currency }).format(val);

            const exportCSV = () => {
                const headers = ['Date', 'Type', 'Category', 'Notes', 'Amount'];
                const rows = reportTransactionsList.map(t => [t.date, t.type, t.category, `"${t.notes}"`, t.amount]);
                const csvContent = [headers, ...rows].map(e => e.join(',')).join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `PROMINT_Report_${reportRange.start}_to_${reportRange.end}.csv`;
                link.click();
            };

            const emailBackup = () => {
                const dateStr = new Date().toLocaleDateString();
                const body = `PROMINT BACKUP - ${dateStr}\n\nNet Balance: ${formatCurrency(stats.net)}\n\nRAW DATA:\n${JSON.stringify({ transactions, budgets, savingsGoals, profile })}`;
                window.location.href = `mailto:${profile.email}?subject=PROMINT Backup&body=${encodeURIComponent(body)}`;
            };

            const getGoalIcon = (iconName) => {
                switch (iconName) {
                    case 'Gift': return 'Gift';
                    case 'Building2': return 'Building2';
                    default: return 'ShoppingBag';
                }
            };

            return (
                <div className={`${isDarkMode ? 'dark' : ''}`}>
                    <div className="min-h-screen bg-[#F8FAFC] dark:bg-[#0F172A] text-slate-900 dark:text-slate-100 flex flex-col md:flex-row transition-colors duration-500 overflow-x-hidden">
                        
                        {/* Sidebar (Desktop) */}
                        <nav className="w-72 bg-white dark:bg-[#1E293B] border-r border-slate-200/60 dark:border-slate-800 hidden md:flex flex-col shrink-0">
                            <div className="p-10 border-b border-slate-100 dark:border-slate-800 flex items-center gap-4">
                                <div className="w-12 h-12 bg-violet-600 rounded-2xl overflow-hidden shadow-xl shadow-violet-100 dark:shadow-none shrink-0">
                                    <img src={LOGO_DATA_URL} alt="P" className="w-full h-full" />
                                </div>
                                <span className="text-violet-600 dark:text-violet-400 font-black text-2xl tracking-tighter uppercase truncate">Promint</span>
                            </div>
                            <div className="flex-1 p-6 space-y-2 overflow-y-auto custom-scrollbar">
                                <NavItem active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon="LayoutDashboard" label="Dashboard" />
                                <NavItem active={activeTab === 'transactions'} onClick={() => setActiveTab('transactions')} icon="Receipt" label="Transactions" />
                                <NavItem active={activeTab === 'budgets'} onClick={() => setActiveTab('budgets')} icon="Target" label="Budgets" />
                                <NavItem active={activeTab === 'savings'} onClick={() => setActiveTab('savings')} icon="PiggyBank" label="Savings" />
                                <NavItem active={activeTab === 'reports'} onClick={() => setActiveTab('reports')} icon="FileText" label="Reports" />
                                <NavItem active={activeTab === 'profile'} onClick={() => setActiveTab('profile')} icon="User" label="Profile" />
                                <NavItem active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} icon="Settings" label="Settings" />
                            </div>
                            <div className="p-8 border-t border-slate-50 dark:border-slate-800">
                                <button onClick={() => setIsModalOpen(true)} className="w-full bg-violet-600 hover:bg-violet-700 text-white py-4 rounded-3xl font-black flex items-center justify-center gap-3 shadow-2xl shadow-violet-200 dark:shadow-none active:scale-95 transition-all text-sm uppercase tracking-widest">
                                    <Icon name="Plus" size={20} /> Add Entry
                                </button>
                            </div>
                        </nav>

                        {/* Main Content Area */}
                        <main className="flex-1 overflow-y-auto max-h-screen p-6 md:p-10 lg:p-14">
                            <header className="flex justify-between items-center mb-10">
                                <div className="flex items-center gap-5">
                                    <div className="md:hidden w-12 h-12 bg-violet-600 rounded-2xl overflow-hidden shadow-xl shrink-0">
                                        <img src={LOGO_DATA_URL} alt="P" className="w-full h-full" />
                                    </div>
                                    <div>
                                        <h1 className="text-3xl md:text-4xl font-black dark:text-white tracking-tight hidden md:block capitalize">{activeTab}</h1>
                                        <div className="flex items-center gap-2 text-slate-500 dark:text-slate-400 text-[11px] font-black uppercase tracking-[0.2em] ml-1">
                                            {!isOnline ? <Icon name="WifiOff" size={14} className="text-rose-500" /> : syncing ? <Icon name="RefreshCw" size={14} className="animate-spin text-violet-500" /> : <Icon name="CheckCircle2" size={14} className="text-emerald-500" />}
                                            <span>{!isOnline ? 'Offline' : 'Cloud Sync Active'}</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    <button onClick={() => setIsDarkMode(!isDarkMode)} className="p-4 rounded-3xl bg-white dark:bg-[#1E293B] border border-slate-200 dark:border-slate-800 text-slate-600 dark:text-slate-300 shadow-sm hover:shadow-lg transition-all active:scale-90">
                                        {isDarkMode ? <Icon name="Sun" /> : <Icon name="Moon" />}
                                    </button>
                                    <div onClick={() => setActiveTab('profile')} className="flex items-center gap-3 bg-white dark:bg-[#1E293B] px-5 py-2.5 border border-slate-200 dark:border-slate-800 rounded-3xl cursor-pointer hover:border-violet-400 shadow-sm transition-all shrink-0">
                                        <div className="w-8 h-8 rounded-xl bg-violet-100 dark:bg-violet-900/50 text-violet-600 dark:text-violet-400 flex items-center justify-center text-sm font-black uppercase shrink-0">{profile.name.charAt(0)}</div>
                                        <span className="hidden lg:inline text-sm font-black dark:text-slate-200 tracking-tight truncate max-w-[120px]">{profile.name}</span>
                                    </div>
                                </div>
                            </header>

                            {/* Views */}
                            {activeTab === 'dashboard' && (
                                <div className="space-y-12 animate-scale-in">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                                        <StatCard label="Net Balance" value={formatCurrency(stats.net)} icon="Wallet" bg="bg-violet-600" />
                                        <StatCard label="Savings Pool" value={formatCurrency(savingsStats.total)} icon="PiggyBank" bg="bg-fuchsia-600" />
                                        <StatCard label="Budget Used" value={formatCurrency(totalBudgetStats.totalSpent)} icon="Target" bg="bg-emerald-600" />
                                        <StatCard label="Net Expenses" value={formatCurrency(stats.expenses)} icon="ArrowDownLeft" bg="bg-rose-600" />
                                    </div>
                                    
                                    <div className="grid grid-cols-1 xl:grid-cols-3 gap-10">
                                        <div className="xl:col-span-2 space-y-10">
                                            <div className="bg-white dark:bg-[#1E293B] rounded-[3.5rem] border border-slate-100/80 dark:border-slate-800 premium-shadow p-10">
                                                <h3 className="font-black text-slate-800 dark:text-white mb-10 flex items-center gap-4 text-xl tracking-tight"><Icon name="PieChart" size={24} className="text-violet-600" /> Budget Intelligence</h3>
                                                <div className="flex flex-col md:flex-row items-center gap-12">
                                                    <div className="relative w-48 h-48 flex-shrink-0">
                                                        <svg className="w-full h-full transform -rotate-90">
                                                            <circle cx="96" cy="96" r="86" fill="transparent" stroke={isDarkMode ? '#0F172A' : '#F8FAFC'} strokeWidth="14" />
                                                            <circle cx="96" cy="96" r="86" fill="transparent" stroke={totalBudgetStats.isOver ? '#F43F5E' : '#7C3AED'} strokeWidth="14" strokeDasharray={540} strokeDashoffset={540 - (540 * Math.min(totalBudgetStats.percent, 100)) / 100} strokeLinecap="round" className="transition-all duration-1000" />
                                                        </svg>
                                                        <div className="absolute inset-0 flex flex-col items-center justify-center text-center">
                                                            <span className={`text-3xl font-black ${totalBudgetStats.isOver ? 'text-rose-600' : 'text-violet-600 dark:text-violet-400'}`}>{Math.round(totalBudgetStats.percent)}%</span>
                                                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">Utilized</span>
                                                        </div>
                                                    </div>
                                                    <div className="flex-1 w-full grid grid-cols-1 sm:grid-cols-2 gap-8">
                                                        <DetailBox label="Monthly Cap" value={formatCurrency(totalBudgetStats.totalAllocated)} />
                                                        <DetailBox label="Current Spent" value={formatCurrency(totalBudgetStats.totalSpent)} color={totalBudgetStats.isOver ? 'text-rose-600' : 'text-emerald-600'} />
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="bg-white dark:bg-[#1E293B] rounded-[3.5rem] border border-slate-100/80 dark:border-slate-800 premium-shadow p-10">
                                                <h3 className="font-black text-slate-800 dark:text-white mb-10 flex items-center justify-between text-xl tracking-tight">
                                                    <span>Recent History</span>
                                                    <button onClick={() => setActiveTab('transactions')} className="text-xs text-violet-600 font-black uppercase tracking-widest p-2 rounded-lg transition-all hover:bg-violet-50">Full Ledger</button>
                                                </h3>
                                                <div className="space-y-6">
                                                    {transactions.slice(0, 5).map(tx => (
                                                        <TransactionRow key={tx.id} tx={tx} profile={profile} category={categories.find(c => c.name === tx.category)} onDelete={() => deleteTransaction(tx.id)} />
                                                    ))}
                                                    {transactions.length === 0 && <p className="text-center py-8 text-slate-400 italic text-sm font-medium">No activity recorded.</p>}
                                                </div>
                                            </div>
                                        </div>
                                        <div className="bg-white dark:bg-[#1E293B] rounded-[3.5rem] border border-slate-100/80 dark:border-slate-800 premium-shadow p-10 self-start">
                                            <h3 className="font-black text-slate-800 dark:text-white mb-10 flex items-center gap-4 text-xl tracking-tight"><Icon name="PiggyBank" size={24} className="text-fuchsia-500" /> Goal Buckets</h3>
                                            <div className="space-y-10">
                                                {savingsGoals.length > 0 ? savingsGoals.map(goal => (
                                                    <div key={goal.id} className="space-y-4">
                                                        <div className="flex justify-between text-[11px] font-black uppercase tracking-wider">
                                                            <span className="dark:text-slate-300 text-slate-600 truncate max-w-[100px] font-bold">{goal.name}</span>
                                                            <span className="text-slate-400 font-bold">{Math.round((goal.saved / goal.target) * 100)}%</span>
                                                        </div>
                                                        <div className="w-full bg-slate-100 dark:bg-slate-900 h-2.5 rounded-full overflow-hidden">
                                                            <div className="h-full bg-gradient-to-r from-violet-500 to-fuchsia-500 transition-all duration-1000 shadow-[0_0_10px_rgba(139,92,246,0.3)]" style={{ width: `${Math.min((goal.saved / goal.target) * 100, 100)}%` }} />
                                                        </div>
                                                        <p className="text-[10px] font-bold text-slate-400 text-right">{formatCurrency(goal.saved)} / {formatCurrency(goal.target)}</p>
                                                    </div>
                                                )) : <div className="text-center py-10 border-2 border-dashed border-slate-100 dark:border-slate-800 rounded-[2.5rem] px-6"><p className="text-xs text-slate-400 italic font-medium leading-relaxed">Bucket goals will appear here as you save.</p></div>}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'transactions' && (
                                <div className="space-y-8 animate-scale-in">
                                    <div className="bg-white dark:bg-[#1E293B] rounded-[3.5rem] border border-slate-100/80 dark:border-slate-800 premium-shadow overflow-hidden">
                                        <div className="p-10 border-b border-slate-50 dark:border-slate-800">
                                            <div className="relative max-w-xl">
                                                <Icon name="Search" className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                                                <input type="text" placeholder="Filter ledger..." className="w-full pl-14 pr-8 py-5 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] dark:text-slate-100 outline-none focus:ring-4 focus:ring-violet-500/10 transition-all text-sm font-bold shadow-inner" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                            </div>
                                        </div>
                                        <div className="overflow-x-auto custom-scrollbar">
                                            <table className="w-full text-left min-w-[900px]">
                                                <thead>
                                                    <tr className="bg-slate-50/50 dark:bg-slate-900/50 text-slate-500 text-[11px] font-black uppercase tracking-[0.2em]"><th className="px-12 py-7">Date</th><th className="px-12 py-7">Label</th><th className="px-12 py-7">Memo</th><th className="px-12 py-7 text-right">Amount</th><th className="px-12 py-7 text-center">Manage</th></tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-50 dark:divide-slate-800">
                                                    {transactions.filter(t => (t.notes || t.category || '').toLowerCase().includes(searchQuery.toLowerCase())).map(tx => {
                                                        const cat = categories.find(c => c.name === tx.category);
                                                        return (
                                                            <tr key={tx.id} className="hover:bg-slate-50/70 dark:hover:bg-slate-900/40 transition-colors group">
                                                                <td className="px-12 py-8 text-xs text-slate-400 font-bold">{tx.date}</td>
                                                                <td className="px-12 py-8 text-[11px]"><span className="px-4 py-2 rounded-xl font-black uppercase tracking-tight" style={{ backgroundColor: cat ? `${cat.color}15` : 'rgba(139,92,246,0.1)', color: cat ? cat.color : '#8B5CF6' }}>{tx.category}</span></td>
                                                                <td className="px-12 py-8 text-sm text-slate-700 dark:text-slate-200 font-bold">{tx.notes}</td>
                                                                <td className={`px-12 py-8 text-base text-right font-black ${tx.type === 'Income' ? 'text-emerald-600' : 'text-slate-900 dark:text-white'}`}>{tx.type === 'Income' ? '+' : ''}{formatCurrency(tx.amount)}</td>
                                                                <td className="px-12 py-8 text-center"><button onClick={() => deleteTransaction(tx.id)} className="p-3.5 text-slate-300 hover:text-rose-500 dark:hover:text-rose-400 transition-all opacity-0 group-hover:opacity-100 active:scale-75"><Icon name="Trash2" size={20} /></button></td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                            {transactions.length === 0 && <div className="p-32 text-center text-slate-400 italic font-medium">Financial record is empty.</div>}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'budgets' && (
                                <div className="space-y-12 animate-scale-in">
                                    <div className="flex justify-between items-center">
                                        <h2 className="text-3xl font-black dark:text-white tracking-tight">Financial Constraints</h2>
                                        <button onClick={() => setIsBudgetModalOpen(true)} className="bg-violet-600 text-white px-8 py-3.5 rounded-[1.5rem] text-sm font-black flex items-center gap-3 shadow-xl shadow-violet-100 active:scale-95 transition-all uppercase tracking-widest"><Icon name="Plus" size={24} /> Initialize Target</button>
                                    </div>
                                    {budgetPerformance.length > 0 ? (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                                            {budgetPerformance.map(bp => (
                                                <div key={bp.id} className="bg-white dark:bg-[#1E293B] rounded-[3.5rem] border border-slate-100/80 dark:border-slate-800 p-10 shadow-sm relative group hover:border-violet-400 transition-all">
                                                    <button onClick={() => deleteBudget(bp.id)} className="absolute top-10 right-10 text-slate-200 hover:text-rose-500 transition-all opacity-0 group-hover:opacity-100 active:scale-75"><Icon name="Trash2" size={22}/></button>
                                                    <h4 className="font-black text-slate-800 dark:text-white text-xl tracking-tight mb-4">{bp.category}</h4>
                                                    <div className="text-4xl font-black text-violet-600 dark:text-violet-400 mb-8">{formatCurrency(bp.amount)}</div>
                                                    <div className="w-full bg-[#F1F5F9] dark:bg-[#0F172A] h-4 rounded-full overflow-hidden mb-8 shadow-inner">
                                                        <div className={`h-full transition-all duration-1000 ${bp.isOver ? 'bg-rose-500' : 'bg-violet-600'}`} style={{ width: `${bp.percent}%` }} />
                                                    </div>
                                                    <div className="flex justify-between items-center pt-2">
                                                        <span className="text-[11px] font-black uppercase text-slate-400 tracking-widest">Absorbed: {formatCurrency(bp.actual)}</span>
                                                        <span className={`text-[10px] font-black uppercase px-3 py-1 rounded-full ${bp.isOver ? 'bg-rose-50 text-rose-600' : 'bg-emerald-50 text-emerald-600'}`}>{bp.isOver ? 'Exceeded' : 'Active'}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="bg-white dark:bg-[#1E293B] rounded-[4rem] border-2 border-dashed border-slate-100 dark:border-slate-800 p-32 text-center flex flex-col items-center justify-center">
                                            <div className="w-24 h-24 bg-violet-50 dark:bg-violet-900/20 rounded-[2.5rem] flex items-center justify-center text-violet-300 mb-10"><Icon name="Target" size={56} /></div>
                                            <h3 className="text-2xl font-black dark:text-white mb-4">No Spending Constraints</h3>
                                            <p className="text-slate-400 text-base max-w-sm font-medium leading-relaxed">Establish hard targets for categories to visualize spending velocity automatically.</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'savings' && (
                                <div className="space-y-12 animate-scale-in">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-10">
                                        <StatCard label="Grand Savings" value={formatCurrency(savingsStats.total)} icon="PiggyBank" bg="bg-violet-600" />
                                        <StatCard label="Reserved Capital" value={formatCurrency(savingsStats.allocated)} icon="Target" bg="bg-fuchsia-600" />
                                        <StatCard label="Free surplus" value={formatCurrency(savingsStats.remaining)} icon="Wallet" bg="bg-emerald-600" />
                                    </div>
                                    <div className="bg-white dark:bg-[#1E293B] rounded-[4.5rem] border border-slate-100/80 dark:border-slate-800 p-10 md:p-16 premium-shadow">
                                        <div className="flex flex-col lg:flex-row justify-between items-center gap-10 mb-16">
                                            <h3 className="text-3xl font-black dark:text-white tracking-tight uppercase tracking-wider">Goal Architecture</h3>
                                            <div className="flex gap-6 w-full lg:w-auto">
                                                <button onClick={() => setIsGeneralSavingModalOpen(true)} className="flex-1 lg:flex-none bg-emerald-600 text-white px-10 py-5 rounded-[2rem] font-black flex items-center justify-center gap-4 active:scale-95 shadow-xl transition-all uppercase tracking-widest"><Icon name="ArrowRightLeft" size={24} /> Deposit</button>
                                                <button onClick={() => setIsGoalModalOpen(true)} className="flex-1 lg:flex-none bg-violet-600 text-white px-10 py-5 rounded-[2rem] font-black flex items-center justify-center gap-4 active:scale-95 shadow-xl transition-all uppercase tracking-widest"><Icon name="Plus" size={24} /> New Goal</button>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-12">
                                            {savingsGoals.map(goal => (
                                                <div key={goal.id} className="p-10 rounded-[4rem] border border-slate-100 dark:border-slate-800 bg-[#F8FAFC]/50 dark:bg-[#0F172A]/30 group relative overflow-hidden transition-all hover:border-violet-400">
                                                    <div className="flex justify-between items-start mb-10">
                                                        <div className="w-16 h-16 rounded-[1.75rem] bg-white dark:bg-[#1E293B] border border-slate-100 dark:border-slate-800 flex items-center justify-center text-violet-600 shadow-sm transition-transform group-hover:scale-110">{getGoalIcon(goal.icon)}</div>
                                                        <div className="flex gap-2.5">
                                                            <button onClick={() => { setEditingGoal(goal); setIsGoalModalOpen(true); }} className="p-3 text-slate-300 hover:text-violet-600 transition-colors active:scale-75"><Icon name="Edit2" size={22}/></button>
                                                            <button onClick={() => deleteSavingsGoal(goal.id)} className="p-3 text-slate-300 hover:text-rose-500 transition-colors active:scale-75"><Icon name="Trash2" size={22}/></button>
                                                        </div>
                                                    </div>
                                                    <h4 className="font-black dark:text-white text-2xl mb-1.5">{goal.name}</h4>
                                                    <p className="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-10">Target: {formatCurrency(goal.target)}</p>
                                                    <div className="space-y-6">
                                                        <div className="w-full bg-[#F1F5F9] dark:bg-[#0F172A] h-5 rounded-full overflow-hidden shadow-inner">
                                                            <div className="h-full bg-gradient-to-r from-violet-600 to-fuchsia-500 transition-all duration-1000 shadow-[0_0_15px_rgba(139,92,246,0.3)]" style={{ width: `${Math.min((goal.saved / goal.target) * 100, 100)}%` }} />
                                                        </div>
                                                        <div className="flex justify-between items-center font-black text-xl dark:text-white px-2">
                                                            <span>{formatCurrency(goal.saved)}</span>
                                                            <span className="text-violet-600 dark:text-violet-400">{Math.round((goal.saved / goal.target) * 100)}%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'reports' && (
                                <div className="animate-in fade-in duration-700 space-y-12">
                                    <div className="bg-white dark:bg-[#1E293B] rounded-[4rem] border border-slate-100/80 dark:border-slate-800 p-10 md:p-16 premium-shadow">
                                        <div className="flex flex-col lg:flex-row lg:items-end justify-between gap-12 mb-16">
                                            <div className="space-y-8 flex-1">
                                                <h2 className="text-3xl font-black dark:text-white flex items-center gap-5 tracking-tight"><Icon name="Calendar" size={36} className="text-violet-600" /> Intelligence Cycle</h2>
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-8 max-w-2xl">
                                                    <div className="space-y-3">
                                                        <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-2">Initiate</label>
                                                        <input type="date" value={reportRange.start} onChange={(e) => setReportRange({ ...reportRange, start: e.target.value })} className="w-full p-5 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] dark:text-white outline-none focus:ring-4 focus:ring-violet-500/10 font-bold" />
                                                    </div>
                                                    <div className="space-y-3">
                                                        <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-2">Terminate</label>
                                                        <input type="date" value={reportRange.end} onChange={(e) => setReportRange({ ...reportRange, end: e.target.value })} className="w-full p-5 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] dark:text-white outline-none focus:ring-4 focus:ring-violet-500/10 font-bold" />
                                                    </div>
                                                </div>
                                            </div>
                                            <button onClick={exportCSV} disabled={reportTransactionsList.length === 0} className="bg-violet-600 hover:bg-violet-700 disabled:bg-slate-200 dark:disabled:bg-slate-800 text-white px-10 py-5 rounded-[2.25rem] font-black flex items-center justify-center gap-4 shadow-2xl active:scale-95 transition-all text-base uppercase tracking-widest">
                                                <Icon name="FileSpreadsheet" size={28} /> Export Dataset
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-10">
                                            <DetailBox label="Period Inflow" value={formatCurrency(reportSummaryData.income)} color="text-emerald-600" />
                                            <DetailBox label="Period Outflow" value={formatCurrency(reportSummaryData.expense)} color="text-rose-600" />
                                            <DetailBox label="Net Result" value={formatCurrency(reportSummaryData.net)} />
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'profile' && (
                                <div className="max-w-3xl bg-white dark:bg-[#1E293B] rounded-[4rem] border border-slate-100/80 dark:border-slate-800 p-10 md:p-16 premium-shadow animate-in slide-in-from-right-8 duration-700">
                                    <h3 className="text-3xl font-black mb-14 dark:text-white flex items-center gap-6 tracking-tight"><Icon name="User" size={36} className="text-violet-600" /> Financial Identity</h3>
                                    <form className="space-y-12" onSubmit={(e) => { e.preventDefault(); updateProfile(profile); }}>
                                        <div className="space-y-4">
                                            <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-3">Identity Owner</label>
                                            <input type="text" placeholder="Name" value={profile.name} onChange={(e) => setProfile({...profile, name: e.target.value})} className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] dark:text-slate-100 outline-none focus:ring-4 focus:ring-violet-500/10 text-xl font-black shadow-inner" />
                                        </div>
                                        <div className="space-y-4">
                                            <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-3">Secure Backup Route</label>
                                            <input type="email" placeholder="Gmail Address" value={profile.email} onChange={(e) => setProfile({...profile, email: e.target.value})} className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] dark:text-slate-100 outline-none focus:ring-4 focus:ring-violet-500/10 text-xl font-black shadow-inner" />
                                        </div>
                                        <div className="space-y-4">
                                            <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest ml-3">System Currency</label>
                                            <select value={profile.currency} onChange={(e) => setProfile({...profile, currency: e.target.value})} className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] dark:text-slate-100 outline-none focus:ring-4 focus:ring-violet-500/10 text-xl font-black shadow-inner">
                                                {CURRENCY_OPTIONS.map(opt => <option key={opt.code} value={opt.code}>{opt.label}</option>)}
                                            </select>
                                        </div>
                                        <div className="flex flex-col sm:flex-row gap-8 pt-8">
                                            <button type="submit" className="flex-1 bg-violet-600 hover:bg-violet-700 text-white py-6 rounded-[2.25rem] font-black shadow-2xl active:scale-95 transition-all text-lg uppercase tracking-widest">Synchronize</button>
                                            <button onClick={emailBackup} type="button" className="flex-1 bg-white dark:bg-[#0F172A] border border-slate-200 dark:border-slate-800 text-slate-700 dark:text-slate-200 py-6 rounded-[2.25rem] font-black flex items-center justify-center gap-4 active:scale-95 transition-all shadow-sm text-lg uppercase tracking-widest"><Icon name="Mail" size={28} /> Push Backup</button>
                                        </div>
                                    </form>
                                </div>
                            )}

                            {activeTab === 'settings' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-12 animate-in fade-in duration-700">
                                    <div className="bg-white dark:bg-[#1E293B] rounded-[4rem] border border-slate-100/80 dark:border-slate-800 premium-shadow p-10 md:p-14 text-slate-900 dark:text-slate-100">
                                        <h3 className="font-black mb-14 flex justify-between items-center text-2xl tracking-tight uppercase tracking-wider">
                                            <span>Label Foundry</span>
                                            <button onClick={() => setIsCategoryModalOpen(true)} className="text-[11px] bg-violet-600 text-white px-6 py-3 rounded-[1.25rem] font-black uppercase tracking-widest shadow-xl hover:scale-110 active:scale-95 transition-all">New Entity</button>
                                        </h3>
                                        <div className="space-y-6">
                                            {categories.map(cat => (
                                                <div key={cat.id} className="flex items-center justify-between p-6 bg-[#F8FAFC]/50 dark:bg-[#0F172A]/30 border border-transparent rounded-[2.5rem] transition-all hover:border-violet-300 hover:bg-white dark:hover:bg-[#1E293B]">
                                                    <div className="flex items-center gap-6">
                                                        <div className="w-14 h-14 rounded-2xl shadow-lg shrink-0" style={{ backgroundColor: cat.color }} />
                                                        <span className="font-black text-lg tracking-tight truncate">{cat.name}</span>
                                                    </div>
                                                    <button onClick={() => deleteCategory(cat.id)} className="p-3.5 text-slate-300 hover:text-rose-500 transition-colors shrink-0 active:scale-75"><Icon name="Trash2" size={24} /></button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </main>

                        {/* Mobile Navigation (Floating Bottom Bar) */}
                        <div className="fixed bottom-10 left-1/2 -translate-x-1/2 bg-white/95 dark:bg-[#1E293B]/95 backdrop-blur-3xl border border-slate-200/60 dark:border-slate-800 px-10 py-5 md:hidden flex justify-between items-center z-50 shadow-[0_25px_60px_rgba(0,0,0,0.15)] rounded-[3.5rem] w-[92%] max-w-lg">
                            <MobileNavItem active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon="LayoutDashboard" />
                            <MobileNavItem active={activeTab === 'transactions'} onClick={() => setActiveTab('transactions')} icon="Receipt" />
                            <button onClick={() => setIsModalOpen(true)} className="flex-shrink-0 w-16 h-16 bg-violet-600 text-white rounded-[1.75rem] flex items-center justify-center -mt-14 shadow-2xl active:scale-90 transition-all border-[8px] border-[#F8FAFC] dark:border-[#0F172A]"><Icon name="Plus" size={36} /></button>
                            <MobileNavItem active={activeTab === 'savings'} onClick={() => setActiveTab('savings')} icon="PiggyBank" />
                            <MobileNavItem active={activeTab === 'profile'} onClick={() => setActiveTab('profile')} icon="User" />
                        </div>

                        {/* Modals Logic */}
                        {isModalOpen && (
                            <Modal title="Commit Record" onClose={() => setIsModalOpen(false)}>
                                <form className="space-y-10" onSubmit={(e) => {
                                    e.preventDefault();
                                    const fd = new FormData(e.target);
                                    addTransaction({ date: fd.get('date') || todayDate, type: fd.get('type'), category: fd.get('category'), amount: fd.get('type') === 'Expense' ? -Math.abs(Number(fd.get('amount'))) : Math.abs(Number(fd.get('amount'))), notes: fd.get('notes') });
                                }}>
                                    <div className="grid grid-cols-2 gap-6">
                                        <label className="cursor-pointer group"><input type="radio" name="type" value="Expense" defaultChecked className="hidden peer" /><div className="text-center py-6 rounded-[2.25rem] border-[6px] border-slate-50 dark:border-slate-800 peer-checked:border-rose-500/20 peer-checked:bg-rose-50/50 peer-checked:text-rose-600 dark:peer-checked:bg-rose-900/20 font-black text-[11px] uppercase transition-all tracking-[0.2em]">Expense</div></label>
                                        <label className="cursor-pointer group"><input type="radio" name="type" value="Income" className="hidden peer" /><div className="text-center py-6 rounded-[2.25rem] border-[6px] border-slate-50 dark:border-slate-800 peer-checked:border-emerald-500/20 peer-checked:bg-emerald-50/50 peer-checked:text-emerald-600 dark:peer-checked:bg-emerald-900/20 font-black text-[11px] uppercase transition-all tracking-[0.2em]">Income</div></label>
                                    </div>
                                    <div className="space-y-8">
                                        <input required name="amount" type="number" step="0.01" placeholder="0.00" className="w-full p-10 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[3rem] text-slate-900 dark:text-white font-black text-6xl outline-none focus:ring-[12px] focus:ring-violet-500/5 text-center transition-all shadow-inner" />
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                            <div className="space-y-3">
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Classification</label>
                                                <select name="category" className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm">
                                                    {categories.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}
                                                </select>
                                            </div>
                                            <div className="space-y-3">
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Executed On</label>
                                                <input type="date" name="date" defaultValue={todayDate} className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm" />
                                            </div>
                                        </div>
                                        <div className="space-y-3">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Transaction Memo</label>
                                            <input name="notes" placeholder="e.g. System upgrade..." className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm" />
                                        </div>
                                    </div>
                                    <button className="w-full bg-violet-600 hover:bg-violet-700 text-white py-7 rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all text-xl uppercase tracking-[0.1em]">Commit Entry</button>
                                </form>
                            </Modal>
                        )}

                        {isGeneralSavingModalOpen && (
                            <Modal title="Global Deposit" onClose={() => setIsGeneralSavingModalOpen(false)}>
                                <form className="space-y-10" onSubmit={(e) => {
                                    e.preventDefault();
                                    const fd = new FormData(e.target);
                                    addTransaction({ date: todayDate, type: 'Transfer', category: 'Savings', amount: Math.abs(Number(fd.get('amount'))), notes: fd.get('notes') || 'Direct capital injection' });
                                    setIsGeneralSavingModalOpen(false);
                                }}>
                                    <p className="text-base text-slate-500 font-bold text-center px-10">Increase total surplus by injecting capital into the global savings pool.</p>
                                    <input required name="amount" type="number" step="0.01" placeholder="0.00" className="w-full p-10 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[3rem] text-slate-900 dark:text-white font-black text-6xl outline-none focus:ring-[12px] focus:ring-emerald-500/5 text-center transition-all shadow-inner" />
                                    <input name="notes" placeholder="Details (Optional)" className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm" />
                                    <button className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-7 rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all text-xl uppercase tracking-widest">Commit Deposit</button>
                                </form>
                            </Modal>
                        )}

                        {isBudgetModalOpen && (
                            <Modal title="Establish Limitation" onClose={() => setIsBudgetModalOpen(false)}>
                                <form className="space-y-10" onSubmit={(e) => {
                                    e.preventDefault();
                                    const fd = new FormData(e.target);
                                    addBudget({ category: fd.get('category'), amount: parseFloat(fd.get('amount')), month: fd.get('month') });
                                }}>
                                    <div className="space-y-8">
                                        <div className="space-y-3">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Classification</label>
                                            <select name="category" className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm">
                                                {categories.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-3">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Cap Limit</label>
                                            <input required name="amount" type="number" step="0.01" className="w-full p-8 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2.5rem] text-slate-900 dark:text-slate-100 font-black text-4xl text-center shadow-inner" placeholder="0.00" />
                                        </div>
                                        <div className="space-y-3">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Effective Cycle</label>
                                            <input required name="month" type="month" defaultValue={currentMonthKey} className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm" />
                                        </div>
                                    </div>
                                    <button className="w-full bg-violet-600 hover:bg-violet-700 text-white py-7 rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all text-xl uppercase tracking-widest">Lock Constraints</button>
                                </form>
                            </Modal>
                        )}

                        {isGoalModalOpen && (
                            <Modal title={editingGoal ? "Modify Savings Cluster" : "Initialize Cluster"} onClose={() => { setIsGoalModalOpen(false); setEditingGoal(null); }}>
                                <form className="space-y-10" onSubmit={(e) => {
                                    e.preventDefault();
                                    const fd = new FormData(e.target);
                                    const goalData = { name: fd.get('name'), target: parseFloat(fd.get('target')), saved: parseFloat(fd.get('saved')), icon: fd.get('icon') };
                                    saveToCloud('savingsGoals', editingGoal ? editingGoal.id : Date.now().toString(), goalData);
                                    setIsGoalModalOpen(false);
                                    setEditingGoal(null);
                                }}>
                                    <div className="space-y-8">
                                        <input required name="name" defaultValue={editingGoal?.name || ''} placeholder="Cluster Identity" className="w-full p-8 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2.5rem] text-slate-900 dark:text-white font-black text-3xl shadow-inner" />
                                        <div className="grid grid-cols-2 gap-8 text-slate-900 dark:text-slate-100">
                                            <div className="space-y-3">
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Target Reserve</label>
                                                <input required name="target" type="number" defaultValue={editingGoal?.target || ''} placeholder="0.00" className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] font-black shadow-sm" />
                                            </div>
                                            <div className="space-y-3">
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Initial Balance</label>
                                                <input required name="saved" type="number" defaultValue={editingGoal?.saved || '0'} placeholder="0.00" className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] font-black shadow-sm" />
                                            </div>
                                        </div>
                                        <div className="space-y-3">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-4 tracking-widest">Category Icon</label>
                                            <select name="icon" defaultValue={editingGoal?.icon || 'ShoppingBag'} className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] text-slate-900 dark:text-slate-100 font-black outline-none shadow-sm">
                                                <option value="ShoppingBag">Physical Purchase</option>
                                                <option value="Gift">Personal Bounty</option>
                                                <option value="Building2">Strategic Investment</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button className="w-full bg-violet-600 hover:bg-violet-700 text-white py-7 rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all text-xl uppercase tracking-widest">{editingGoal ? 'Commit Changes' : 'Create Cluster'}</button>
                                </form>
                            </Modal>
                        )}

                        {isCategoryModalOpen && (
                            <Modal title="Entity Foundry" onClose={() => setIsCategoryModalOpen(false)}>
                                <form className="space-y-10" onSubmit={(e) => {
                                    e.preventDefault();
                                    const fd = new FormData(e.target);
                                    addCategory({ name: fd.get('name'), type: fd.get('type'), color: fd.get('color') });
                                }}>
                                    <input required name="name" placeholder="Entity Label" className="w-full p-8 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[2.5rem] text-slate-900 dark:text-white font-black text-3xl shadow-inner" />
                                    <select name="type" className="w-full p-6 bg-[#F1F5F9] dark:bg-[#0F172A] border-none rounded-[1.75rem] text-slate-900 dark:text-slate-100 font-black shadow-sm"><option value="Expense">Expense Stream</option><option value="Income">Income Stream</option></select>
                                    <div className="grid grid-cols-5 gap-4 p-5 bg-[#F1F5F9] dark:bg-[#0F172A] rounded-[2.5rem] shadow-inner">
                                        {PRESET_COLORS.map(color => (
                                            <label key={color} className="relative cursor-pointer"><input type="radio" name="color" value={color} defaultChecked={color === PRESET_COLORS[0]} className="hidden peer" /><div className="w-full aspect-square rounded-2xl border-4 border-transparent peer-checked:border-white dark:peer-checked:border-slate-500 shadow-md transition-all scale-95 peer-checked:scale-105" style={{ backgroundColor: color }} /></label>
                                        ))}
                                    </div>
                                    <button className="w-full bg-violet-600 text-white py-7 rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all text-xl uppercase tracking-widest">Authorize Entity</button>
                                </form>
                            </Modal>
                        )}
                    </div>
                </div>
            );
        }

        // Subcomponents
        function NavItem({ active, icon, label, onClick }) {
            return (
                <button onClick={onClick} className={`w-full flex items-center gap-5 px-8 py-5 rounded-[2rem] transition-all group ${active ? 'bg-violet-600 text-white shadow-2xl shadow-violet-200 dark:shadow-none font-black' : 'text-slate-500 dark:text-slate-400 hover:bg-[#F8FAFC] dark:hover:bg-[#0F172A]'}`}>
                    <span className={`${active ? 'text-white' : 'text-slate-400 dark:text-slate-500 group-hover:text-violet-500'} transition-colors shrink-0`}><Icon name={icon} size={22} /></span>
                    <span className="text-[13px] tracking-tight truncate font-bold">{label}</span>
                </button>
            );
        }

        function MobileNavItem({ active, icon, onClick }) {
            return (
                <button onClick={onClick} className={`p-4 transition-all rounded-[1.75rem] active:scale-90 ${active ? 'text-violet-600 bg-violet-100/60 dark:bg-violet-900/30' : 'text-slate-400 dark:text-slate-500'}`}>
                    <Icon name={icon} size={26} strokeWidth={2.5} />
                </button>
            );
        }

        function StatCard({ label, value, icon, bg }) {
            return (
                <div className="bg-white dark:bg-[#1E293B] p-10 rounded-[3.5rem] border border-slate-100/60 dark:border-slate-800 premium-shadow hover:shadow-xl transition-all group shrink-0 relative overflow-hidden">
                    <div className={`w-16 h-16 ${bg} text-white rounded-[1.5rem] flex items-center justify-center mb-8 group-hover:scale-110 transition-transform shadow-xl`}>
                        <Icon name={icon} size={28} strokeWidth={2.5} />
                    </div>
                    <div className="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">{label}</div>
                    <div className="text-3xl font-black dark:text-white tracking-tighter truncate">{value}</div>
                    <div className={`absolute -right-6 -bottom-6 w-24 h-24 ${bg} opacity-[0.03] rounded-full`} />
                </div>
            );
        }

        function DetailBox({ label, value, color = "text-slate-800 dark:text-white" }) {
            return (
                <div className="p-10 bg-[#F8FAFC] dark:bg-[#0F172A] rounded-[3rem] flex flex-col gap-2 border border-white/50 dark:border-slate-800 shadow-inner">
                    <p className="text-[11px] uppercase font-black text-slate-400 mb-2 tracking-widest ml-1">{label}</p>
                    <p className={`text-2xl font-black tracking-tighter ${color} truncate`}>{value}</p>
                </div>
            );
        }

        function TransactionRow({ tx, category, profile, onDelete }) {
            return (
                <div className="flex items-center justify-between p-4 rounded-[2.5rem] transition-all hover:bg-[#F8FAFC] dark:hover:bg-[#0F172A] group border border-transparent hover:border-slate-100 dark:hover:border-slate-800 animate-in slide-in-from-left-4 duration-400">
                    <div className="flex items-center gap-6 min-w-0">
                        <div className="w-14 h-14 rounded-2xl flex items-center justify-center text-white font-black text-base shadow-lg shrink-0" style={{ backgroundColor: category?.color || '#cbd5e1' }}>{tx.category ? tx.category.charAt(0) : 'T'}</div>
                        <div className="min-w-0">
                            <div className="font-black text-base text-slate-800 dark:text-slate-200 tracking-tight leading-tight truncate">{tx.notes}</div>
                            <div className="text-[10px] text-slate-400 font-black uppercase tracking-widest mt-1 truncate">{tx.category}</div>
                        </div>
                    </div>
                    <div className="flex items-center gap-6 shrink-0">
                        <div className={`text-base font-black ${tx.type === 'Income' ? 'text-emerald-600' : 'text-slate-900 dark:text-white'}`}>{tx.type === 'Income' ? '+' : ''}{new Intl.NumberFormat('en-US', { style: 'currency', currency: profile.currency }).format(tx.amount || 0)}</div>
                        <button onClick={onDelete} className="p-3 text-slate-200 hover:text-rose-500 dark:hover:text-rose-400 transition-all opacity-0 group-hover:opacity-100 active:scale-75"><Icon name="Trash2" size={20} /></button>
                    </div>
                </div>
            );
        }

        function Modal({ title, onClose, children }) {
            return (
                <div className="fixed inset-0 bg-slate-950/60 dark:bg-black/80 backdrop-blur-3xl z-[100] flex items-center justify-center p-4 animate-in fade-in duration-300">
                    <div className="bg-white dark:bg-[#1E293B] rounded-[4rem] w-full max-w-2xl shadow-[0_32px_64px_-12px_rgba(0,0,0,0.14)] overflow-hidden animate-in zoom-in-95 duration-400 border border-white/50 dark:border-slate-700">
                        <div className="px-14 py-10 border-b border-slate-50 dark:border-slate-800 flex justify-between items-center">
                            <h3 className="font-black text-2xl dark:text-white tracking-tight">{title}</h3>
                            <button onClick={onClose} className="p-4 text-slate-400 hover:bg-[#F1F5F9] dark:hover:bg-[#0F172A] rounded-2xl transition-all active:scale-90"><Icon name="X" size={32} /></button>
                        </div>
                        <div className="p-14 max-h-[80vh] overflow-y-auto custom-scrollbar">
                            {children}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
